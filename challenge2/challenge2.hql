ADD JAR /home/training/Desktop/json-serde-1.3-jar-with-dependencies.jar;

SELECT b.state, b.name, b.categories, SUM(COALESCE(c.checkin_info['5-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-0'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-1'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-2'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-3'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-4'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-5'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['5-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['6-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['7-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['8-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['9-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['10-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['11-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['12-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['13-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['14-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['15-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['16-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['17-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['18-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['19-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['20-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['21-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['22-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['23-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['0-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['1-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['2-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['3-6'], CAST(0 AS BIGINT)) +  COALESCE(c.checkin_info['4-6'], CAST(0 AS BIGINT))) AS total_checkins
FROM checkins c
JOIN business b
ON c.business_id = b.business_id
WHERE array_contains(b.categories, "Restaurants") AND state = '${hiveconf:STATE}'
GROUP BY b.state, b.name, b.categories
ORDER BY state ASC, total_checkins DESC, name
LIMIT 3;
